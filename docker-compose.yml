version: "3.8"

services:
  omega-dev:
    build:
      context: .
      dockerfile: Dockerfile.dev
    container_name: omega-dev
    volumes:
      - .:/workspace
    cap_add:
      - NET_ADMIN    # TUN device creation
      - SYS_ADMIN    # eBPF program loading
    devices:
      - /dev/net/tun:/dev/net/tun
    sysctls:
      - net.ipv4.ip_forward=1
    privileged: false
    stdin_open: true
    tty: true
    command: bash

  # Optional: second container to simulate a client
  omega-client:
    build:
      context: .
      dockerfile: Dockerfile.dev
    container_name: omega-client
    volumes:
      - .:/workspace
    cap_add:
      - NET_ADMIN
    devices:
      - /dev/net/tun:/dev/net/tun
    stdin_open: true
    tty: true
    command: bash
    depends_on:
      - omega-dev

networks:
  default:
    driver: bridge
    ipam:
      config:
        - subnet: 172.28.0.0/16
